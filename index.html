<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JWR DEX</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white font-sans min-h-screen">
  <header class="flex justify-between items-center p-4 border-b border-gray-700">
    <h1 class="text-xl font-bold text-blue-400">JWR Mini DEX</h1>
    <div id="walletStatus">
      <span id="connectBtn" class="text-sm px-3 py-1 bg-blue-600 rounded cursor-pointer" onclick="connectWallet()">Connect</span>
    </div>
  </header>  <main class="p-4 max-w-xl mx-auto space-y-6">
    <p id="walletBalance">Balance: -</p><div class="flex justify-center space-x-2">
  <button class="tab-btn px-4 py-2 bg-gray-700 rounded active" onclick="showTab('liquidity')">Add Liquidity</button>
  <button class="tab-btn px-4 py-2 bg-gray-700 rounded" onclick="showTab('swap')">Swap</button>
  <button class="tab-btn px-4 py-2 bg-gray-700 rounded" onclick="showTab('pool')">Pool</button>
</div>

<div id="liquidity" class="bg-gray-800 p-4 rounded">
  <h3 class="text-lg font-semibold mb-2">Add Liquidity</h3>
  <input id="amountA" class="w-full p-2 mb-2 rounded bg-gray-700" placeholder="Amount JWR">
  <input id="amountB" class="w-full p-2 mb-2 rounded bg-gray-700" placeholder="Amount USDT">
  <button class="w-full py-2 bg-blue-500 rounded" onclick="addLiquidity()">Add Liquidity</button>
</div>

<div id="swap" class="bg-gray-800 p-4 rounded hidden">
  <h3 class="text-lg font-semibold mb-2">Swap</h3>
  <select id="swapFrom" class="w-full p-2 mb-2 rounded bg-gray-700">
    <option value="0x4E54B5aeB805D826a6c1Ad8abC9cBf05E49457c3">JWR</option>
    <option value="0x3eC8A8705bE1D5ca90066b37ba62c4183B024ebf">USDT</option>
  </select>
  <select id="swapTo" class="w-full p-2 mb-2 rounded bg-gray-700">
    <option value="0x3eC8A8705bE1D5ca90066b37ba62c4183B024ebf">USDT</option>
    <option value="0x4E54B5aeB805D826a6c1Ad8abC9cBf05E49457c3">JWR</option>
  </select>
  <input id="swapAmount" class="w-full p-2 mb-2 rounded bg-gray-700" placeholder="Amount to Swap">
  <button class="w-full py-2 bg-green-500 rounded" onclick="swapTokens()">Swap</button>
</div>

<div id="pool" class="bg-gray-800 p-4 rounded hidden">
  <h3 class="text-lg font-semibold mb-2">Pool Info</h3>
  <p>Total JWR Liquidity: <span id="poolJWR">-</span></p>
  <p>Total USDT Liquidity: <span id="poolUSDT">-</span></p>
</div>

  </main>  <script>
    let provider, signer, walletAddress;
    const JWR = "0x4E54B5aeB805D826a6c1Ad8abC9cBf05E49457c3";
    const USDT = "0x3eC8A8705bE1D5ca90066b37ba62c4183B024ebf";
    const ROUTER = "0xB91deeDbc60F3507D5206Df4E051A11b74C6158E";
    const ABI_ERC20 = ["function approve(address,uint) external returns (bool)","function allowance(address,address) view returns (uint256)","function balanceOf(address) view returns (uint256)"];
    const ABI_ROUTER = ["function swapExactTokensForTokens(uint,uint,address[],address,uint) external returns (uint[] memory)","function addLiquidity(address,address,uint,uint,uint,uint,address,uint) external returns (uint,uint,uint)"];

    async function connectWallet() {
      const injected = window.okxwallet || window.ethereum;
      if (!injected) return alert("Install MetaMask atau OKX Wallet dulu bro");
      try {
        provider = new ethers.BrowserProvider(injected);
        signer = await provider.getSigner();
        walletAddress = await signer.getAddress();

        await provider.send("wallet_addEthereumChain", [{
          chainId: '0x40d9',
          chainName: '0G-Galileo-Testnet',
          rpcUrls: ['https://evmrpc-testnet.0g.ai'],
          nativeCurrency: { name: 'OG Token', symbol: 'OG', decimals: 18 },
          blockExplorerUrls: ['https://chainscan-galileo.0g.ai/']
        }]);

        const rawBal = await provider.getBalance(walletAddress);
        const ethBal = ethers.formatEther(rawBal);
        document.getElementById("walletBalance").innerText = `Balance: ${parseFloat(ethBal).toFixed(4)} OG`;

        document.getElementById("walletStatus").innerHTML = `
          <span class='text-green-400 text-sm'>${walletAddress.slice(0, 6)}...${walletAddress.slice(-4)}</span>
          <span class='text-red-400 ml-2 cursor-pointer text-sm' onclick='disconnectWallet()'>Disconnect</span>`;

        updatePool();
      } catch (err) {
        alert("Gagal konek wallet: " + err.message);
      }
    }

    function disconnectWallet() {
      provider = signer = walletAddress = null;
      document.getElementById("walletStatus").innerHTML = `
        <span id='connectBtn' class='text-sm px-3 py-1 bg-blue-600 rounded cursor-pointer' onclick='connectWallet()'>Connect</span>`;
      document.getElementById("walletBalance").innerText = "Balance: -";
    }

    function showTab(id) {
      ["liquidity","swap","pool"].forEach(x => document.getElementById(x).classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("bg-blue-500"));
      event.target.classList.add("bg-blue-500");
    }

    async function addLiquidity() {
  if (!signer) return alert("Connect wallet dulu bro");

  const valA = document.getElementById("amountA").value;
  const valB = document.getElementById("amountB").value;

  if (!valA || isNaN(valA) || !valB || isNaN(valB)) {
    return alert("Masukin angka yang valid di kedua input");
  }

  const amtA = ethers.parseUnits(valA, 18);
  const amtB = ethers.parseUnits(valB, 18);

  const tokenA = new ethers.Contract(JWR, ABI_ERC20, signer);
  const tokenB = new ethers.Contract(USDT, ABI_ERC20, signer);
  const router = new ethers.Contract(ROUTER, ABI_ROUTER, signer);

  try {
    const allowanceA = await tokenA.allowance(walletAddress, ROUTER);
    const allowanceB = await tokenB.allowance(walletAddress, ROUTER);

    if (allowanceA < amtA) await tokenA.approve(ROUTER, amtA);
    if (allowanceB < amtB) await tokenB.approve(ROUTER, amtB);

    const deadline = Math.floor(Date.now() / 1000) + 600;
    const tx = await router.addLiquidity(JWR, USDT, amtA, amtB, 0, 0, walletAddress, deadline);
    await tx.wait();
    alert("Liquidity added!");
    updatePool();
  } catch (err) {
    console.error("Add liquidity error:", err);
    alert("Gagal add liquidity: " + err.message);
  }
}
    async function swapTokens() {
      if (!signer) return alert("Connect wallet first");
      const from = document.getElementById("swapFrom").value;
      const to = document.getElementById("swapTo").value;
      const amt = ethers.parseUnits(document.getElementById("swapAmount").value, 18);
      const token = new ethers.Contract(from, ABI_ERC20, signer);
      const router = new ethers.Contract(ROUTER, ABI_ROUTER, signer);
      if ((await token.allowance(walletAddress, ROUTER)) < amt) await token.approve(ROUTER, amt);
      const deadline = Math.floor(Date.now() / 1000) + 600;
      await router.swapExactTokensForTokens(amt, 0, [from, to], walletAddress, deadline);
      alert("Swap success");
      updatePool();
    }

    async function updatePool() {
      const tokenA = new ethers.Contract(JWR, ABI_ERC20, provider);
      const tokenB = new ethers.Contract(USDT, ABI_ERC20, provider);
      const a = await tokenA.balanceOf(ROUTER);
      const b = await tokenB.balanceOf(ROUTER);
      document.getElementById("poolJWR").innerText = ethers.formatUnits(a, 18);
      document.getElementById("poolUSDT").innerText = ethers.formatUnits(b, 18);
    }
  </script></body>
</html>
