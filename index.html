<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JWR DEX</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      background: #0f0f0f;
      color: white;
      font-family: sans-serif;
      text-align: center;
      padding-top: 40px;
    }
    input, select, button {
      margin: 8px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
    }
    .card {
      background: #1c1c1c;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      margin: auto;
    }
  </style>
</head>
<body>
  <h1>JWR Mini DEX</h1>
  <button onclick="connectWallet('ethereum')">Connect MetaMask</button>
  <button onclick="connectWallet('okxwallet')">Connect OKX</button>
  <p id="walletAddress"></p>  <div class="card">
    <h2>Add Liquidity</h2>
    <input id="amountA" placeholder="Amount JWR" />
    <input id="amountB" placeholder="Amount USDT" />
    <button onclick="addLiquidity()">Add Liquidity</button>
  </div>  <div class="card">
    <h2>Swap</h2>
    <select id="swapFrom">
      <option value="0x4E54B5aeB805D826a6c1Ad8abC9cBf05E49457c3">JWR</option>
      <option value="0x3eC8A8705bE1D5ca90066b37ba62c4183B024ebf">USDT</option>
    </select>
    <select id="swapTo">
      <option value="0x4E54B5aeB805D826a6c1Ad8abC9cBf05E49457c3">JWR</option>
      <option value="0x3eC8A8705bE1D5ca90066b37ba62c4183B024ebf">USDT</option>
    </select>
    <input id="swapAmount" placeholder="Amount to Swap" />
    <button onclick="swapTokens()">Swap</button>
  </div>  <script>
    let provider, signer, account;
    const JWR_TOKEN = "0x4E54B5aeB805D826a6c1Ad8abC9cBf05E49457c3";
    const USDT_TOKEN = "0x3eC8A8705bE1D5ca90066b37ba62c4183B024ebf";
    const ROUTER = "0xB91deeDbc60F3507D5206Df4E051A11b74C6158E";
    const ABI_ERC20 = [
      "function approve(address spender, uint amount) external returns (bool)",
      "function allowance(address owner, address spender) view returns (uint256)",
      "function balanceOf(address) view returns (uint256)"
    ];
    const ABI_ROUTER = [
      "function swapExactTokensForTokens(uint amountIn, uint amountOutMin, address[] calldata path, address to, uint deadline) external returns (uint[] memory)",
      "function addLiquidity(address tokenA, address tokenB, uint amountADesired, uint amountBDesired, uint amountAMin, uint amountBMin, address to, uint deadline) external returns (uint amountA, uint amountB, uint liquidity)"
    ];

    async function connectWallet(source) {
      const wallet = window[source];
      if (!wallet) return alert("Wallet " + source + " not detected");

      const chainParams = {
        chainId: "0x40d1",
        chainName: "0G-Galileo-Testnet",
        nativeCurrency: { name: "OG", symbol: "OG", decimals: 18 },
        rpcUrls: ["https://evmrpc-testnet.0g.ai/"],
        blockExplorerUrls: ["https://chainscan-galileo.0g.ai/"]
      };

      try {
        await wallet.request({ method: "wallet_addEthereumChain", params: [chainParams] });
        provider = new ethers.BrowserProvider(wallet);
        signer = await provider.getSigner();
        account = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Connected: " + account;
      } catch (err) {
        alert("Failed to connect: " + err.message);
      }
    }

    async function addLiquidity() {
      const amtA = ethers.parseUnits(document.getElementById("amountA").value, 18);
      const amtB = ethers.parseUnits(document.getElementById("amountB").value, 18);
      const tokenA = new ethers.Contract(JWR_TOKEN, ABI_ERC20, signer);
      const tokenB = new ethers.Contract(USDT_TOKEN, ABI_ERC20, signer);
      const router = new ethers.Contract(ROUTER, ABI_ROUTER, signer);

      if ((await tokenA.allowance(account, ROUTER)) < amtA) await tokenA.approve(ROUTER, amtA);
      if ((await tokenB.allowance(account, ROUTER)) < amtB) await tokenB.approve(ROUTER, amtB);

      const deadline = Math.floor(Date.now() / 1000) + 600;
      await router.addLiquidity(JWR_TOKEN, USDT_TOKEN, amtA, amtB, 0, 0, account, deadline);
      alert("Liquidity added!");
    }

    async function swapTokens() {
      const amt = ethers.parseUnits(document.getElementById("swapAmount").value, 18);
      const from = document.getElementById("swapFrom").value;
      const to = document.getElementById("swapTo").value;
      const tokenFrom = new ethers.Contract(from, ABI_ERC20, signer);
      const router = new ethers.Contract(ROUTER, ABI_ROUTER, signer);

      if ((await tokenFrom.allowance(account, ROUTER)) < amt) await tokenFrom.approve(ROUTER, amt);

      const deadline = Math.floor(Date.now() / 1000) + 600;
      await router.swapExactTokensForTokens(amt, 0, [from, to], account, deadline);
      alert("Swap sukses!");
    }
  </script></body>
</html>
